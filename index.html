<!--
	@author Marcin Wawrzyniak 
	
	DO NOT LOOK AT THAT UGLY SOURCE CODE! 
	GO AWAY IN PEACE.
-->
<!DOCTYPE html>
<html>
	<head>
		<title>TR Performance Optimizations</title>
		<meta charset='utf-8'>
		<script src='./slides.js'></script>
		<style media="print">
			@page {
			size: A4 landscape;
			@top-right {
			content: "Page " counter(page);
			}
			}
			article {
			page-break-after: always;
			margin: auto;
			}
			article.next, article.past {
			display: block;    
			}
			body {
			display: block !important;
			font-family: 'Open Sans', Arial, sans-serif;
			font-size: 1.5em;
			}
			.article{
			page-brake-before:always;
			}
		</style>
		<script type="text/javascript">
			window.addEventListener('load', function(){
				var link = document.getElementsByTagName('link');
				link[link.length-1].setAttribute ("media","screen");
			});
		</script>
	</head>
	<style>
		.slides.template-default > article:not(.nobackground):not(.biglogo) {
		background-image: none !important;
		}
		.number{
		width:300px;
		text-align:right;
		font-size:20px !important;
		position:absolute;
		bottom:20px;
		right:20px;
		}	  
		.logo {
		width: 147px;
		height:64px;
		background-image: url("./images/tr.png");
		position: absolute;
		bottom: 20px;
		left: 20px;
		}
	</style>
	<body style='display: none'>
		<section class='slides layout-regular template-default'>
			<article>
				<h1>
					<img src="./images/tr.png" />
					<br />
				</h1>
				<p>
					Performance optimization story 
				</p>
				<br><br>
				<p style="font-size:12px;text-align:right;margin-top:300px;"><b>Nacho Team</b></p>
				<p style="position:absolute;bottom:20px;left:65px;"><a style="color:orange;font-size:30px;" href="http://bit.do/trusted">http://bit.do/trusted</a></p>
			</article>
			<article>
				<h3>Quick roadmap</h3>
				<ol>
					<li> The problem
					<li> The opportunity
					<li> The reason
					<li> The solution
					<li> The actual optimizations
					<li> The plans
					<li>
						The tips
						<!--<li> <b>Chrome Developer Tools</b> quick review-->
					<li> The quotes, must-reads and a <b>nice chat</b>.
				</ol>
				<p class="number">1 / 16</p>
			</article>
			<article class="smaller">
				<h3> The problem </h3>
				<p>The problem is that when page loads long, <b>bounce rate</b> goes up and <b>user satisfaction drops</b>.</p>
				<br />
				<center>
					<p><img src="http://www.roaringtraffic.com/wp-content/uploads/2013/06/page-speed-abondonment-rate.jpeg" /></p>
					<br /><br />
					<h3 class="red">First bits of TR showed up after 11 seconds</h3>
				</center>
				<p class="number">2 / 16</p>
			</article>
			<article class="smaller">
				<h3>The opportunity</h3>
				<p>Since we were doing new design anyway, I asked Ignacio if we could tune up performance a little bit..</p>
				<br />
				<h3>he said...</h3>
				<br />
				<center><img src="http://media.giphy.com/media/QBjH0bEtlZheg/giphy.gif"></center>
				<p class="number">3 / 16</p>
			</article>
			<article class="smaller">
				<img src="./images/nacho.jpg" width="800px"/>
				<small><a style="font-size:12px;" href="http://www.imdb.com/title/tt0457510/">* Nacho Libre (2006) IMDB</a></small>
				<p class="number">4 / 16</p>
			</article>
			<article class="smaller">
				<h3>The reason</h3>
				<h4>We loaded lot of stuff before user could see the page</h4>
				<ul>
					<li>
					<li> Blocking (synchronous) JavaScript in head (inline or src)
					<li> Blocking (synchronous) JavaScript in body, placed randomly (inline or src)
					<li> YUI ? 
					<li> jQuery ? 
					<li>Analytics ? 
					<li>Optimizely ? 
					<li>IPC includes ? 
					<li>Facebook connect? 
					<li>Post.it ?		  
				</ul>
				<p>Everytime the parser gets into the &lt;script&gt; tag (<i>without async or defer</i>), it stops <b>everything</b>, fetches the resource and/or parses the script - then it continues. 
				</p>
				<p class="number">5 / 16</p>
			</article>
			<article class="smaller">
				<h3>The solution</h3>
				<h4>We load less stuff before user sees the page *. Asynchronously.</h4>
				<p>
				<ul>
					<li><b>async</b>  <a href="http://caniuse.com/#search=async">&gt;=IE9</a> - "A script that will be run asynchronously as soon as it is available", without blocking the DOM construction process
					<li><b>defer</b>  <a href="http://caniuse.com/#search=defer">&gt;=IE8</a> - "A script that will not run until the page has loaded"
				</ul>
				</p>
				<br />
				<center><img src="http://avc.name/wp-content/uploads/2012/04/script-defer-asyn.jpg" /></center>
				<p style="position:absolute;bottom:60px;left:20px;"><small>* Apparently I broke a few things because of that (Omniture?). Keep in mind that you will probably break stuff.</small></p>
				<p class="number">6 / 16</p>
			</article>
			<article class="smaller">
				<h3>Optimizations we did</h3>
				<ul>
					<li>We moved the rest of images to sprites = <b style="color:orange">5 requests</b> saved
					<li>Combined almost every CSS stylesheet we had = <b style="color:orange">3 requests</b> saved
					<li>We removed the CSS for print, in two places = <b style="color:orange">2 requests</b>	
					<li><b>We removed a 1500 lines long SCSS file</b></li>
					<li>Disqus loading on scroll to comments box = <b style="color:orange">37 requests</b> saved
					<li>Minified Omniture with rest of JS (doesn't matter, will be removed by end of year) = <b style="color:orange">1 request</b> saved
					<li><b>Made use of trViewKit::jsSlot() -&gt; moved all inline blocking JS to before body end - <i>probably</i> big impact</b>
					<li>And of course, we made use of async, in three places, wow. 
				</ul>
				<center><img src="http://i.imgur.com/S25EO.gif"></center>
				<p class="number">7 / 16</p>
			</article>
			<article class="smaller">
				<h3>Optimizations we did: WebPageTest <a href="http://www.webpagetest.org/video/compare.php?tests=131125_T3_104M%2C131117_96_KYR&thumbSize=200&ival=500&end=visual">before/after</a></h3>
				<p>Before:</p>
				<img src="http://i.imgur.com/doPd66m.png" width="800px" />
				<p>After:</p>
				<img src="http://i.imgur.com/UpckA1R.png" width="800px"/>
				<br />
				<center><img src="http://i.imgur.com/P5vYTiQ.png" width="500px"/></center>
				<p class="number">8 / 16</p>
			</article>
			<article class="smaller">
				<h3>In plans: 1/3</h3>
				<center><img style="margin:auto" src="http://i.imgur.com/iWXoE85.png" /></center>
				<ul>
				<!-- separate slide -->
				<li>
					Sharded CDN (cookie-less) domains
					<ul>
						<li>no cookie payload (8kB)
						<li> more 	
							parallel connections
						<li>we would like to serve JS and CSS from static domains yet
					</ul>
					<p class="number">9 / 16</p>
			</article>
			<article class="smaller">
			<h3>In plans: 2/3</h3>
			<p>We would like to try lazy loading of images on the lists (<a href="https://github.com/toddmotto/echo">Echo?</a>)</p>
			<ul>
			<li>Usually out of viewport
			<li>37 requests to static.trustedreviews.com
			<li>... these requests delay onload
			<li>... we can also load image when user scrolls to it
			<li>... but sharded CDN can be the optimal solution here.
			</ul>
			<center><img src="http://d1ac1bzf3lrf3c.cloudfront.net/static/cache/7f/32/7f324b4ef6bd620c129677238af45ccb.jpg" width="650px"></center>
			<p class="number">10 / 16</p>
			</article>
			<article class="smaller">
			<h3>In plans: 3/3</h3>
			<ul>
			<li>HTML minification (10-30% smaller size, <a href="http://modpagespeed.com/">mod_pagespeed?</a>) 
			<li>not everything is gzipped... includes/*.js ?
			<li>images are not 100% optimized, we can do better, including our sprites
			<li>serve jQuery from Google CDN, or minified with the rest of assets?
			<li>in some places we have deep level nesting - 15+ levels (<a href="http://mir.aculo.us/dom-monster/">DOMMonster</a> or <a href="https://developer.mozilla.org/en-US/docs/Tools/3D_View">Firefox 3D layer view</a>)
			<li>we would like to try localStorage, and keep there YUI and jquery, and large inline scripts (1kB+) - <a href="addyosmani.github.io/basket.js/">basket.js</a>
			</ul>
			<p class="number">11 / 16</p>
			</article>
			<article class="smaller">
			<h3>Tips 1/3</h3>
			<h4>AKAMAI</h4>
			<p>
			When you specify a vary header, other than: <b>Vary: Accept-Encoding</b> AKAMAI won't cache anything!
			</p>
			<h4>Other</h4>
			<p>
			Wait patiently for <a href="https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourcePriorities/Overview.html">postpone and lazyload</a> (Resource Priorities)<br>
			<br>Use CSS instead of images if possible - buttons? arrows? shadows? borders? gradient? transparency? (<a href="http://css-shack.herokuapp.com/">CSS Shack - Photoshop for CSS</a>)<br>
			</p>
			<h4>Images</h3>
			<p>
			<ul> 
			<li>Tune up the images delivery - use sharded CDN for static images (cookie-less)
			<li>Do you really want user wait, because you have to send 57 image requests ?<br>
			<small><i>Maybe you can load only the images visible on the viewport, and rest after onload?</i></small> 
			</ul>
			<p class="number">12 / 16</p>
			</article>
			<article class="smaller">
			<h3>Tips 2/3</h3>
			<p style="
				font-weight: bold;
				">Yeah, Firefox can do that...</p> 
			<p>Trusted Reviews in 3D...</p><br>
			<center><img src="http://i.imgur.com/cDkcOsw.png" width="650px"></center>
			<p class="number">13 / 16</p>
			</article>
			<article class="smaller current">
			<h3>Tips 3/3</h3>
			<center><p><a href="http://stevesouders.com/cuzillion/?c0=hj1hfff2_0_f&amp;c1=hc1hfff2_0_f&amp;c2=hb0hfff0_0_f&amp;c3=hj1hfff2_0_f&amp;c4=bj1hfff2_0_f&amp;c5=bb0hfff0_0_f&amp;c6=bi1hfff2_0_f&amp;c7=bj1hfff2_0_f&amp;c8=bb0hfff0_0_f&amp;c9=bi1hfff2_0_f&amp;c10=bj1hfff2_0_f&amp;c11=bb0hfff0_0_f&amp;t=1385576024786">Like waterfalls?</a></p><img src="http://i.imgur.com/Iefvug9.png" height="500px"><p>You can reproduce here your actual webpage structure, and test it's behaviour.</p></center>
			<p class="number">14 / 16</p>
			</article>
			<article class="smaller">
			<h3>The thing is...</h3>
			<span style="font-size: 20px;">
			<blockquote>"It's not about how fast your website is, it's about how fast user thinks it is." - S.Souders</blockquote>
			<blockquote>"The fastest HTTP request is the one not made." - Some Genius</blockquote>
			<blockquote>"Know the rules well so you can break them efficiently" - Dalai Lama</blockquote>
			<blockquote>"1kB of JS is 1ms of parsing" - Google</blockquote>
			<blockquote>"Web performance & optimization is a process, not a checklist" - I. Grigorik</blockquote>
			<blockquote>"Don't ask for permission, ask for forgiveness." - Facebook</blockquote>
			</span>
			<center><img src="http://i.imgur.com/7s8APdU.gif"></center>
			<p class="number">15 / 16</p>
			</article>
			<article class="smaller">
			<h3>Must read</h3> <br >
			<p>
			<a href="http://www.smashingmagazine.com/2013/06/10/pinterest-paint-performance-case-study/">Gone In 60 Frames Per Second: A Pinterest Paint Performance Case Study</a> <br /><br />
			<a href="http://cdn.oreillystatic.com/en/assets/1/event/99/Prioritize%20Your%20Critical%20CSS%20and%20Images%20To%20Make%20Your%20Site%20Fast%20Presentation.pdf">Prioritize Your Critical CSS and Images to render site fast</a><br /><br />
			<a href="http://www.igvita.com/slides/2012/devtools-tips-and-tricks/#38">* DevTools Tips and Tricks</a><br /><br />
			<a href="http://www.igvita.com/slides/2012/webperf-crash-course.pdf">* WebPerf Crash Course</a><br /><br />
			<a href="http://addyosmani.com/blog/performance-optimisation-with-timeline-profiles/">Improving Web App Performance With the Chrome DevTools Timeline and Profiles</a><br /><br />
			</p>
			<p style="position:absolute;bottom:30px;left:65px;"><a style="color:orange;font-size:35px;" href="http://bit.do/trusted">http://bit.do/trusted</a></p>
			<p>* If you have only time for one, pick these two.</p>
			<p class="number">16 / 16</p>
			</article>
			<article class="smaller">
			<h2>Thanks!</h2>
			</article>
		</section>
	</body>
</html>